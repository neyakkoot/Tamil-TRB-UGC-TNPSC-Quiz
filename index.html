<!DOCTYPE html>
<html lang="ta">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>родрооро┐ро┤рпН роЗро▓роХрпНроХро┐роп ро╡ро░ро▓ро╛ро▒рпБ ро╡ро┐ройро╛роЯро┐тАУро╡ро┐ройро╛</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Tamil&display=swap" rel="stylesheet">

<style>
  body {
    font-family: 'Noto Sans Tamil', sans-serif;
    margin: 0;
    background: #f5f7fb;
    color: #222;
    padding-bottom: 70px; /* ЁЯСС рокрпБродро┐роп рооро╛ро▒рпНро▒роорпН: роиро┐ро▓рпИропро╛рой роЕроЯро┐роХрпНроХрпБро▒ро┐рокрпНрокро┐ро▒рпНроХрпБ роЗроЯроорпН роТродрпБроХрпНроХ ЁЯСС */
  }
  .hidden { display: none !important; }
  #login-container {
    max-width: 500px;
    margin: 80px auto; 
    padding: 25px; 
    background: #fff;
    border-radius: 10px;
    box-shadow: 0 4px 14px rgba(0, 0, 0, 0.08);
    text-align: center;
  }
  #login-container h2 { color: #007bff; }
  #username-input {
    width: 90%;
    padding: 10px; 
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 1rem;
    margin-top: 10px;
  }
  #login-btn {
    padding: 10px 20px; 
    border-radius: 8px;
    border: none;
    font-weight: 700;
    cursor: pointer;
    color: #fff;
    background: #28a745;
    font-size: 1rem;
    margin-top: 15px; 
    transition: background 0.3s;
  }
  #login-btn:hover { background: #218838; }
  #dashboard-container {
    max-width: 1000px;
    margin: 15px auto; 
    background: #fff;
    padding: 15px; 
    border-radius: 10px;
    box-shadow: 0 4px 14px rgba(0, 0, 0, 0.08);
  }
  #dashboard-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 2px solid #007bff;
    padding-bottom: 8px; 
    margin-bottom: 15px; 
  }
  #dashboard-header h2 { color: #007bff; margin: 0; font-size: 1.3rem; }
  #logout-btn {
    padding: 6px 12px; 
    border: none;
    border-radius: 6px;
    background: #dc3545;
    color: white;
    font-weight: 700;
    cursor: pointer;
    font-size: 0.9rem; 
  }
  #dashboard-stats {
    display: flex;
    gap: 15px; 
    margin-bottom: 15px; 
    text-align: center;
  }
  .stat-card {
    flex: 1;
    background: #f4f4f4;
    padding: 10px; 
    border-radius: 8px;
  }
  .stat-card h4 { margin: 0 0 5px 0; color: #555; font-size: 0.9rem; }
  .stat-card p { margin: 0; font-size: 1.3rem; font-weight: 700; color: #007bff; }
  #dashboard-history table, #leaderboard-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
  }
  #dashboard-history th, #dashboard-history td, #leaderboard-table th, #leaderboard-table td {
    border: 1px solid #ddd;
    padding: 8px; 
    text-align: left;
    font-size: 0.9rem; 
  }
  #dashboard-history th, #leaderboard-table th { background-color: #f2f2f2; color: #333; }
  .header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: linear-gradient(90deg, #007bff, #00b894);
    color: white;
    padding: 8px 15px; 
    border-bottom: 4px solid #0a58ca;
  }
  .header h1 { margin: 0; font-size: 1.4rem; text-align: center; }
  .header p { margin: 2px 0 0; font-size: 0.9rem; text-align: center; }
  .header img {
    width: 60px; 
    height: 60px; 
    border-radius: 50%;
    border: 1px solid #fff; 
    background: white;
    object-fit: cover;
  }
  @media (max-width: 768px) {
    .header { flex-direction: column; text-align: center; }
    .header img { width: 50px; height: 50px; margin: 4px 0; }
  }
  #tv-quiz-wrap {
    max-width: 1000px;
    margin: 15px auto; 
    background: #fff;
    padding: 15px; 
    border-radius: 10px;
    box-shadow: 0 4px 14px rgba(0, 0, 0, 0.08);
    display: grid;
    /* ЁЯСС рокроХрпНроХро╡ро╛роЯрпНроЯрпБрокрпН рокроХрпБродро┐ропрпИроХрпН роХрпБро▒рпИродрпНродрпБ ро╡ро┐ройро╛рокрпН рокроХрпБродро┐роХрпНроХрпБ роЕродро┐роХ роЗроЯроорпН ЁЯСС */
    grid-template-columns: 1fr 260px; 
    gap: 15px; 
  }
  @media (max-width: 900px) { #tv-quiz-wrap { grid-template-columns: 1fr; } }
  
  /* ЁЯСС рокрпБродро┐роп рокро╛рогро┐: роиро┐ро▓рпИропро╛рой роЕроЯро┐роХрпНроХрпБро▒ро┐рокрпНрокрпБ (Fixed Footer) ЁЯСС */
  #fixed-footer-nav {
    display: none; /* роЖро░роорпНрокродрпНродро┐ро▓рпН рооро▒рпИроХрпНроХро╡рпБроорпН */
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    max-width: 1000px; /* роЯро╛ро╖рпНрокрпЛро░рпНроЯро┐ройрпН роЕродро┐роХрокроЯрпНроЪ роЕроХро▓роорпН */
    margin: 0 auto;
    padding: 10px 15px;
    background: #fefefe;
    border-top: 1px solid #ddd;
    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
    z-index: 1000;
    box-sizing: border-box;
  }
  @media (min-width: 1001px) {
      /* родро┐ро░рпИропро┐ройрпН роЕроХро▓роорпН 1000px роР ро╡ро┐роЯ роЕродро┐роХрооро╛роХ роЗро░рпБроирпНродро╛ро▓рпН, роорпИропрокрпНрокроЯрпБродрпНродро╡рпБроорпН */
      #fixed-footer-nav {
          left: 50%;
          transform: translateX(-50%);
      }
  }

  .quiz-nav {
    display: flex;
    justify-content: space-between;
    width: 100%;
  }
  /* ЁЯСС End of New Style ЁЯСС */

  #tv-main { 
    display: flex; 
    flex-direction: column; 
    padding-bottom: 5px; /* роЕроЯро┐роХрпНроХрпБро▒ро┐рокрпНрокрпБроХрпНроХрпБродрпН родропро╛ро░ро╛роХроХрпН роХрпКроЮрпНроЪроорпН роЗроЯрпИро╡рпЖро│ро┐ */
  }

  #quizSelect {
    display: block;
    width: 100%;
    margin-bottom: 12px; 
    padding: 9px; 
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 0.95rem; 
    background: #fefefe;
  }
  #tv-progress {
    text-align: center;
    font-weight: 700;
    color: #555;
    background: #eef4ff;
    padding: 6px; 
    border-radius: 6px;
    margin-bottom: 10px; 
  }
  #tv-question {
    font-size: 1.1rem; 
    font-weight: 700;
    line-height: 1.4; 
    margin-bottom: 10px; 
  }
  #tv-options { display: flex; flex-direction: column; gap: 8px; }
  .option-btn {
    padding: 10px; 
    border-radius: 6px; 
    border: 1px solid #ddd;
    background: #f9f9f9;
    text-align: left;
    cursor: pointer;
    font-size: 0.95rem; 
    transition: all 0.2s ease-in-out;
  }
  .option-btn:hover { background: #e7f0ff; }
  .option-btn.correct { background: #e6f7e9; border-color: #28a745; }
  .option-btn.wrong { background: #fdecea; border-color: #dc3545; }
  #tv-feedback {
    display: none;
    margin-top: 10px; 
    padding: 10px; 
    border-radius: 6px; 
    background: #f9f9f9;
    border: 1px solid #ddd;
    font-size: 0.9rem; 
  }
  #tv-side {
    background: #f5fcf8;
    border: 1px solid #cce5d3;
    border-radius: 10px;
    padding: 10px; 
    font-size: 0.85rem; 
    display: flex;
    flex-direction: column;
  }
  #tv-side h3 { color: #006644; margin-top: 0; font-size: 1rem; }
  #tv-prev, #tv-next {
    padding: 8px 12px; 
    border-radius: 6px; 
    border: none;
    font-weight: 700;
    cursor: pointer;
    color: #fff;
    font-size: 0.9rem; 
  }
  #tv-prev { background: #ff9800; }
  #tv-next { background: #007bff; }
  #tv-results {
    display: none;
    margin-top: 15px; 
    text-align: center;
    border-top: 2px solid #007bff;
    padding-top: 15px; 
  }
  #tv-timer-box, #tv-participants-box {
    text-align: center;
    background: #fff;
    border: 1px solid #007bff; 
    border-radius: 8px;
    padding: 8px; 
    margin-top: 10px; 
  }
  #tv-timer-box h3, #tv-participants-box h3 {
    margin: 0 0 5px 0; 
    color: #007bff;
    font-size: 1rem; 
  }
  #tv-timer-display, #tv-total-participants {
    font-size: 1.8rem; 
    font-weight: 700;
    color: #333;
    letter-spacing: 1px; 
  }
  #tv-total-participants {
    color: #28a745;
  }
  #tv-timer-display.warning {
    color: #dc3545;
    animation: pulse 1.2s infinite;
  }
  @keyframes pulse {
    0% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.03); opacity: 0.7; }
    100% { transform: scale(1); opacity: 1; }
  }
  #tv-result-title { font-size: 1.6rem; font-weight: 700; color: #28a745; }
  #tv-result-score { font-size: 1.2rem; font-weight: 700; color: #007bff; margin: 8px 0; }
  #tv-result-percentage { font-size: 1rem; font-weight: 700; color: #555; margin: 5px 0 10px 0; }
  #tv-result-message {
    font-size: 1rem; 
    font-style: italic;
    color: #333;
    margin-top: 10px; 
    background: #f4f4f4;
    padding: 8px; 
    border-radius: 6px;
  }
  #tv-restart-btn {
    padding: 10px 18px; 
    border-radius: 8px;
    border: none;
    font-weight: 700;
    cursor: pointer;
    color: #fff;
    background: #28a745;
    font-size: 0.95rem; 
    margin-top: 15px; 
    transition: background 0.3s;
  }
  #tv-restart-btn:hover { background: #218838; }
</style>
</head>
<body>

  <div id="login-container">
    <h2>ЁЯСЛ ро╡рогроХрпНроХроорпН!ЁЯУЪ</h2>
    <p>ро╡ро┐ройро╛роЯро┐-ро╡ро┐ройро╛ родрпКроЯроЩрпНроХрпБроорпН роорпБройрпН, роЙроЩрпНроХро│рпН рокрпЖропро░рпИрокрпН рокродро┐ро╡рпБ роЪрпЖропрпНропро╡рпБроорпН.</p>
    <input type="text" id="username-input" placeholder="роЙроЩрпНроХро│рпН рокрпЖропро░рпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН">
    <button id="login-btn">роЙро│рпНроирпБро┤рпИ</button>
  </div>

  <main id="app-container" class="hidden">

    <div class="header">
      <img src="images/родро┐ро░рпБро╡ро│рпНро│рпБро╡ро░рпН.jpg" alt="родро┐ро░рпБро╡ро│рпНро│рпБро╡ро░рпН">
      <div>
        <h1>родрооро┐ро┤рпН роЗро▓роХрпНроХро┐роп ро╡ро░ро▓ро╛ро▒рпБ ро╡ро┐ройро╛роЯро┐тАУро╡ро┐ройро╛</h1>
        <p>ЁЯУЪ родрпЗро░рпНроирпНродрпЖроЯрпБродрпНродрпБ роорпБропро▒рпНроЪро┐ роЪрпЖропрпНродрпБ роЙроЩрпНроХро│рпН роЕро▒ро┐ро╡рпИроЪрпН роЪрпЛродро┐роХрпНроХро▓ро╛роорпН ЁЯУЪ</p>
      </div>
      <img src="images/родрпКро▓рпНроХро╛рокрпНрокро┐ропро░рпН.jpg" alt="родрпКро▓рпНроХро╛рокрпНрокро┐ропро░рпН">
    </div>

    <div id="dashboard-container">
      <div id="dashboard-header">
        <h2 id="welcome-message">ЁЯУИ роОройрпН роорпБропро▒рпНроЪро┐роХро│рпБроорпН роХро▒рпНро▒ро▓рпН рокродро┐ро╡рпБроХро│рпБроорпН</h2>
        <button id="logout-btn" title="Clear all data and logout">ро╡рпЖро│ро┐ропрпЗро▒рпБ</button>
      </div>
      <div id="dashboard-stats">
        <div class="stat-card">
          <h4>роорпКродрпНрод рокропро┐ро▒рпНроЪро┐роХро│рпН (роЙроЩрпНроХро│рпБроЯрпИропродрпБ)</h4>
          <p id="stat-total-attempts">0</p>
        </div>
        <div class="stat-card">
          <h4>роЪро░ро╛роЪро░ро┐ роородро┐рокрпНрокрпЖрогрпН (роЙроЩрпНроХро│рпБроЯрпИропродрпБ)</h4>
          <p id="stat-avg-score">0%</p>
        </div>
      </div>
      <div id="dashboard-history">
        <h3 style="text-align: center;">роЙроЩрпНроХро│ро┐ройрпН рокропро┐ро▒рпНроЪро┐ ро╡ро░ро▓ро╛ро▒рпБ</h3>
        <table id="history-table">
          <thead>
            <tr>
              <th>родрпЗродро┐</th>
              <th>ро╡ро┐ройро╛роЯро┐-ро╡ро┐ройро╛</th>
              <th>роородро┐рокрпНрокрпЖрогрпН</th>
            </tr>
          </thead>
          <tbody id="history-table-body">
          </tbody>
        </table>
        <p id="no-history-msg" style="text-align: center; display: none;">роирпАроЩрпНроХро│рпН роЗройрпНройрпБроорпН роОроирпНродрокрпН рокропро┐ро▒рпНроЪро┐ропрпБроорпН роОроЯрпБроХрпНроХро╡ро┐ро▓рпНро▓рпИ.</p>
      </div>
      
      <div id="dashboard-leaderboard" style="margin-top: 25px;">
        <h3 style="text-align: center; color: #007bff; font-size: 1.1rem;">ЁЯСе рокроЩрпНроХрпЗро▒рпНрокро╛ро│ро░рпНроХро│ро┐ройрпН роорпБропро▒рпНроЪро┐роХро│рпН</h3>
        <table id="leaderboard-table">
          <thead>
            <tr>
              <th>рокрпЖропро░рпН</th>
              <th>роорпКродрпНрод роорпБропро▒рпНроЪро┐роХро│рпН</th>
            </tr>
          </thead>
          <tbody id="leaderboard-table-body">
            <tr><td colspan="2" style="text-align: center;">родро░ро╡рпБ роПро▒рпНро▒рокрпНрокроЯрпБроХро┐ро▒родрпБ...</td></tr>
          </tbody>
        </table>
      </div>
      </div>

    <div id="tv-quiz-wrap">
      <div id="tv-main">
        <select id="quizSelect">
          <option value="" disabled selected>ЁЯза ро╡ро┐ройро╛роЯро┐тАУро╡ро┐ройро╛ родрпКроХрпБрокрпНрокрпИродрпН родрпЖро░ро┐ро╡рпБроЪрпЖропрпНроХ</option>
        </select>
        <div id="tv-progress"></div>
        <div id="tv-question"></div>
        <div id="tv-options"></div>
        <div id="tv-feedback"></div>
        
        <div id="tv-results">
          <h2 id="tv-result-title">ЁЯОЙ ро╡ро╛ро┤рпНродрпНродрпБроХрпНроХро│рпН! ЁЯОЙ</h2>
          <p id="tv-result-score">роЙроЩрпНроХро│рпН роородро┐рокрпНрокрпЖрогрпН: 0 / 0</p>
          <p id="tv-result-percentage">ро╡ро┐ро┤рпБроХрпНроХро╛роЯрпБ: 0%</p>
          <p id="tv-result-message">роЙроЩрпНроХро│рпН роКроХрпНроХроЪрпН роЪрпЖропрпНродро┐ роЗроЩрпНроХрпЗ...</p>
          <button id="tv-restart-btn">рокрпБродро┐роп ро╡ро┐ройро╛роЯро┐-ро╡ро┐ройро╛ро╡рпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН ЁЯФБ</button>
        </div>
      </div>
      <div id="tv-side">
        <div id="tv-participants-box">
          <h3>ЁЯСд роорпКродрпНродрокрпН рокроЩрпНроХрпЗро▒рпНрокро╛ро│ро░рпНроХро│рпН</h3>
          <div id="tv-total-participants" style="font-size: 1.8rem; font-weight: 700; color: #28a745;">0</div>
        </div>
        <div id="tv-timer-box" style="display:none;">
          <h3>тП░ роирпЗро░роорпН роорпАродроорпБро│рпНро│родрпБ тП░</h3>
          <div id="tv-timer-display">00:00</div>
        </div>
        <h2>ЁЯСитАНЁЯТ╗ роЙро░рпБро╡ро╛роХрпНроХрпБроиро░рпН ЁЯСитАНЁЯТ╗</h2>
        <p>ЁЯСитАНЁЯТ╗ роорпБройрпИро╡ро░рпН роЪродрпНродро┐ропро░ро╛роЪрпБ родроЩрпНроХроЪрпНроЪро╛рооро┐, рокропро┐ро▒рпНро▒рпБроиро░рпН, родрооро┐ро┤рпНроиро╛роЯрпБ, роЗроирпНродро┐ропро╛ тЬНя╕П</p>
      </div>
    </div>
    
    <div id="fixed-footer-nav" class="hidden"> 
      <div class="quiz-nav">
        <button id="tv-prev">ЁЯСИтЭУ роорпБроирпНродрпИроп ро╡ро┐ройро╛</button>
        <button id="tv-next">роЕроЯрпБродрпНрод ро╡ро┐ройро╛ ЁЯСЙтЭУ</button>
      </div>
    </div>

  </main> 


  <script src="js/quiz-loader.js"></script>
  <script src="js/footer-history.js"></script>

  <script>
    // --- ЁЯСС рооро╛ро▒ро┐роХро│рпН ЁЯСС ---
    let inactivityTimer; 
    const INACTIVITY_MINUTES = 4; 

    let timerInterval; 
    let totalSeconds;
    
    const loginContainer = document.getElementById('login-container');
    const appContainer = document.getElementById('app-container');
    const loginBtn = document.getElementById('login-btn');
    const usernameInput = document.getElementById('username-input');
    const logoutBtn = document.getElementById('logout-btn');
    const welcomeMessageEl = document.getElementById('welcome-message');
    const historyTableBodyEl = document.getElementById('history-table-body');
    const noHistoryMsgEl = document.getElementById('no-history-msg');
    const statTotalAttemptsEl = document.getElementById('stat-total-attempts');
    const statAvgScoreEl = document.getElementById('stat-avg-score');
    const leaderboardTableBodyEl = document.getElementById('leaderboard-table-body');
    const totalParticipantsEl = document.getElementById('tv-total-participants');
    
    // ЁЯСС рокрпБродро┐роп рооро╛ро▒ро┐роХро│рпН ЁЯСС
    const fixedFooterNav = document.getElementById('fixed-footer-nav');

    // --- ЁЯСС роЪрпЖропро▓рпНрокроЯро╛ роиро┐ро▓рпИ роирпЗро░роЩрпНроХро╛роЯрпНроЯро┐ропрпИ Reset роЪрпЖропрпН ЁЯСС ---
    function resetInactivityTimer() {
      clearTimeout(inactivityTimer);
      inactivityTimer = setTimeout(() => {
        alert(`роирпАроЩрпНроХро│рпН ${INACTIVITY_MINUTES} роиро┐рооро┐роЯроЩрпНроХро│ро╛роХроЪрпН роЪрпЖропро▓рпНрокроЯро╡ро┐ро▓рпНро▓рпИ. роОройро╡рпЗ, роЗроирпНрод ро╡ро┐ройро╛роЯро┐-ро╡ро┐ройро╛ родро╛ройро╛роХро╡рпЗ роорпБроЯро┐роХрпНроХрокрпНрокроЯрпБроХро┐ро▒родрпБ.`);
        if (typeof showResults === 'function') {
          showResults();
        } else {
          console.error("showResults (from quiz-loader.js) not found for inactivity timeout!");
        }
      }, INACTIVITY_MINUTES * 60 * 1000); 
    }

    // --- ЁЯСС роЪрпЖропро▓рпНрокроЯро╛ роиро┐ро▓рпИ роирпЗро░роЩрпНроХро╛роЯрпНроЯро┐ропрпИ роиро┐ро▒рпБродрпНродрпБ ЁЯСС ---
    function stopInactivityTimer() {
      clearTimeout(inactivityTimer);
    }
    // --- ЁЯСС ---
    
    // ЁЯСС рокрпБродро┐роп роЪрпЖропро▓рпНрокро╛роЯрпБ: роЕроЯро┐роХрпНроХрпБро▒ро┐рокрпНрокрпИ рооро▒рпИ/роХро╛роЯрпНроЯрпБ ЁЯСС
    function toggleFixedFooter(show) {
      if (show) {
        fixedFooterNav.classList.remove('hidden');
        // роорпКрокрпИро▓рпН/роЪро┐ро▒ро┐роп родро┐ро░рпИроХро│ро┐ро▓рпН, ро╡ро┐ройро╛роЯро┐-ро╡ро┐ройро╛ рокроХрпБродро┐ропрпИ footer-роХрпНроХрпБ роорпЗро▓рпН ро╡рпИроХрпНроХро╡рпЗрогрпНроЯро┐ропро┐ро░рпБроХрпНроХро▓ро╛роорпН
        if (window.innerWidth <= 900) { 
            document.body.style.paddingBottom = '70px';
        }
      } else {
        fixedFooterNav.classList.add('hidden');
        document.body.style.paddingBottom = '0'; // роЕроЯро┐роХрпНроХрпБро▒ро┐рокрпНрокрпБ родрпЗро╡рпИропро┐ро▓рпНро▓рпИ роОройрпНро▒ро╛ро▓рпН роирпАроХрпНроХро╡рпБроорпН
      }
    }

    /**
     * ро╡ро┐ройро╛роХрпНроХро│ро┐ройрпН роОрогрпНрогро┐роХрпНроХрпИроХрпНроХрпБ роПро▒рпНрок роиро┐рооро┐роЯроЩрпНроХро│рпИроХрпН роХрогроХрпНроХро┐роЯрпБродро▓рпН (рокро┤рпИроп ро╡ро┐родро┐роХро│ро┐ройрпНрокроЯро┐)
     */
    function calculateMinutes(count) {
      if (count <= 0) return 0;
      if (count <= 25) return count; 
      else if (count > 50 && count <= 100) return 90; 
      else return Math.round(count * 0.9);
    }

    /**
     * ро╡ро┐ройро╛роЯро┐-ро╡ро┐ройро╛ роирпЗро░родрпНродрпИроХрпН роХрогроХрпНроХро┐роЯрпНроЯрпБродрпН родрпКроЯроЩрпНроХрпБроорпН роЪрпЖропро▓рпНрокро╛роЯрпБ
     */
    function startQuizTimer(questionCount) {
      stopTimer(); 
      resetInactivityTimer(); 
      toggleFixedFooter(true); // ЁЯСС ро╡ро┐ройро╛роЯро┐-ро╡ро┐ройро╛ родрпКроЯроЩрпНроХрпБроорпН рокрпЛродрпБ роЕроЯро┐роХрпНроХрпБро▒ро┐рокрпНрокрпИроХрпН роХро╛роЯрпНроЯрпБ ЁЯСС
      
      const timerBox = document.getElementById('tv-timer-box');
      if (!timerBox) return;

      let totalMinutes = calculateMinutes(questionCount);
      totalSeconds = totalMinutes * 60;

      timerBox.style.display = 'block';
      updateTimerDisplay();

      timerInterval = setInterval(() => {
        totalSeconds--;
        updateTimerDisplay();

        if (totalSeconds <= 0) {
          stopTimer(); 
          stopInactivityTimer(); 
          alert('роирпЗро░роорпН роорпБроЯро┐роирпНродродрпБ!');
          
          if (typeof showResults === 'function') {
            showResults();
          } else {
            console.error("showResults function (from quiz-loader.js) not found!");
            showCustomResults(0, 0, "Unspecified Quiz"); 
          }
        }
      }, 1000);
    }

    /**
     * роирпЗро░роЩрпНроХро╛роЯрпНроЯро┐ роХро╛роЯрпНроЪро┐ропрпИрокрпН рокрпБродрпБрокрпНрокро┐роХрпНроХрпБроорпН роЪрпЖропро▓рпНрокро╛роЯрпБ
     */
    function updateTimerDisplay() {
      const timerDisplay = document.getElementById('tv-timer-display');
      if (!timerDisplay) return;
      const minutes = Math.floor(totalSeconds / 60);
      const seconds = totalSeconds % 60;
      timerDisplay.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
      if (totalSeconds <= 60 && !timerDisplay.classList.contains('warning')) {
        timerDisplay.classList.add('warning');
      } else if (totalSeconds > 60) {
        timerDisplay.classList.remove('warning');
      }
    }

    /**
     * роорпКродрпНрод роирпЗро░роЩрпНроХро╛роЯрпНроЯро┐ропрпИ роиро┐ро▒рпБродрпНродрпБроорпН роЪрпЖропро▓рпНрокро╛роЯрпБ
     */
    function stopTimer() {
      clearInterval(timerInterval);
      const timerDisplay = document.getElementById('tv-timer-display');
      if (timerDisplay) {
          timerDisplay.classList.remove('warning');
      }
    }

    /**
     * роКроХрпНроХрооро│ро┐роХрпНроХрпБроорпН роЪрпЖропрпНродро┐ропрпИ ро╡ро┤роЩрпНроХрпБроорпН роЪрпЖропро▓рпНрокро╛роЯрпБ ( unchanged )
     */
    function getMotivationalMessage(percentage) {
      if (percentage === 100) return "ЁЯТп роЕро░рпБроорпИ! роорпБро┤рпБроорпИропро╛рой роородро┐рокрпНрокрпЖрогрпН! роЙроЩрпНроХро│рпН роЙро┤рпИрокрпНрокрпБ роЕрокро╛ро░рооро╛ройродрпБ!";
      else if (percentage >= 90) return "ЁЯОЙ рооро┐роХ роиройрпНро▒рпБ! роЗро▓роХрпНроХрпИ роирпЖро░рпБроЩрпНроХро┐ро╡ро┐роЯрпНроЯрпАро░рпНроХро│рпН. роЙроЩрпНроХро│рпН роорпБропро▒рпНроЪро┐ рокро╛ро░ро╛роЯрпНроЯродрпНродроХрпНроХродрпБ!";
      else if (percentage >= 75) return "ЁЯСН роЪро┐ро▒рокрпНрокро╛роХроЪрпН роЪрпЖропрпНродрпАро░рпНроХро│рпН! роЗройрпНройрпБроорпН роЪро┐ро▒ро┐родрпБ роорпБропро▒рпНроЪро┐родрпНродро╛ро▓рпН роорпБро┤рпБ ро╡рпЖро▒рпНро▒ро┐ропрпИ роЕроЯрпИропро▓ро╛роорпН.";
      else if (percentage >= 50) return "ЁЯЩВ рокро░ро╡ро╛ропро┐ро▓рпНро▓рпИ, роиро▓рпНро▓ роорпБропро▒рпНроЪро┐. родрпКроЯро░рпНроирпНродрпБ рокропро┐ро▒рпНроЪро┐ роЪрпЖропрпНропрпБроЩрпНроХро│рпН, роиро┐роЪрпНроЪропроорпН ро╡рпЖро▓рпНро▓ро▓ро╛роорпН!";
      else if (percentage > 0) return "ЁЯТк роорпБропро▒рпНроЪро┐ родро┐ро░рпБро╡ро┐ройрпИропро╛роХрпНроХрпБроорпН! родро╡ро▒рпБроХро│рпИродрпН родро┐ро░рпБродрпНродро┐роХрпН роХрпКрогрпНроЯрпБ роорпАрогрпНроЯрпБроорпН роорпБропро▓рпБроЩрпНроХро│рпН.";
      else return "ЁЯМ▒ родрпКроЯроХрпНроХроорпН роЪро▒рпНро▒рпБроХрпН роХроЯро┐ройрооро╛роХ роЗро░рпБроХрпНроХро▓ро╛роорпН. рооройроорпН родро│ро░ ро╡рпЗрогрпНроЯро╛роорпН, родрпКроЯро░рпНроирпНродрпБ рокроЯро┐ропрпБроЩрпНроХро│рпН!";
    }

    /**
     * роорпЗроорпНрокроЯрпБродрпНродрокрпНрокроЯрпНроЯ роорпБроЯро┐ро╡рпБроХро│рпИроХрпН роХро╛роЯрпНроЯрпБроорпН роЪрпЖропро▓рпНрокро╛роЯрпБ ( unchanged )
     */
    function showCustomResults(score, totalQuestions, quizTitle) {
      stopTimer(); 
      stopInactivityTimer(); 
      toggleFixedFooter(false); // ЁЯСС ро╡ро┐ройро╛роЯро┐-ро╡ро┐ройро╛ роорпБроЯро┐роирпНродро╡рпБроЯройрпН роЕроЯро┐роХрпНроХрпБро▒ро┐рокрпНрокрпИ рооро▒рпИ ЁЯСС
      
      const timerBox = document.getElementById('tv-timer-box');
      if (timerBox) timerBox.style.display = 'none';

      document.getElementById('tv-progress').style.display = 'none';
      document.getElementById('tv-question').style.display = 'none';
      document.getElementById('tv-options').style.display = 'none';
      document.getElementById('tv-feedback').style.display = 'none';
      // document.querySelector('.quiz-nav').style.display = 'none'; // роЗродрпБ роирпАроХрпНроХрокрпНрокроЯрпНроЯродрпБ, роЗрокрпНрокрпЛродрпБ fixed-footer-nav роЙро│рпНро│родрпБ

      const resultsContainer = document.getElementById('tv-results');
      const titleEl = document.getElementById('tv-result-title');
      const scoreEl = document.getElementById('tv-result-score');
      const percentageEl = document.getElementById('tv-result-percentage');
      const messageEl = document.getElementById('tv-result-message');
      
      if (!resultsContainer) return;

      const percentage = totalQuestions > 0 ? Math.round((score / totalQuestions) * 100) : 0;
      
      titleEl.textContent = (percentage >= 75) ? "ЁЯОЙ ро╡ро╛ро┤рпНродрпНродрпБроХрпНроХро│рпН! ЁЯОЙ" : "ЁЯСП роиро▓рпНро▓ роорпБропро▒рпНроЪро┐! ЁЯСП";
      scoreEl.textContent = `роЙроЩрпНроХро│рпН роородро┐рокрпНрокрпЖрогрпН: ${score} / ${totalQuestions}`;
      percentageEl.textContent = `ро╡ро┐ро┤рпБроХрпНроХро╛роЯрпБ: ${percentage}%`;
      messageEl.textContent = getMotivationalMessage(percentage);

      resultsContainer.style.display = 'block';

      saveQuizResult(quizTitle, score, totalQuestions, percentage);
    }
    
    // --- (рокро┐ройрпНро╡ро░рпБроорпН роЪрпЖропро▓рпНрокро╛роЯрпБроХро│рпН login, dashboard, save... роЗро╡ро▒рпНро▒рпБроХрпНроХро╛ройро╡рпИ) ---

    function checkLogin() {
      const user = localStorage.getItem('quizUser');
      if (user) {
        showApp();
      } else {
        showLogin();
      }
    }

    function showLogin() {
      loginContainer.classList.remove('hidden');
      appContainer.classList.add('hidden');
    }

    function showApp() {
      loginContainer.classList.add('hidden');
      appContainer.classList.remove('hidden');
      const userData = JSON.parse(localStorage.getItem('quizUser'));
      welcomeMessageEl.textContent = `ЁЯУИ роОройрпН роорпБропро▒рпНроЪро┐роХро│рпБроорпН роХро▒рпНро▒ро▓рпН рокродро┐ро╡рпБроХро│рпБроорпН (ро╡рогроХрпНроХроорпН, ${userData.name}!)`;
      loadDashboardData(userData.name);
    }

    /**
     * ро╡ро┐ройро╛роЯро┐-ро╡ро┐ройро╛ роорпБроЯро┐ро╡рпБроХро│рпИроЪрпН роЪрпЗрооро┐родрпНродрпБ, роЕройрпИродрпНродрпБрокрпН рокропройро░рпНроХро│ро┐ройрпН ро╡ро░ро▓ро╛ро▒рпНро▒рпИропрпБроорпН рокрпБродрпБрокрпНрокро┐роХрпНроХро┐ро▒родрпБ.
     */
    function saveQuizResult(title, score, total, percentage) {
      const userName = JSON.parse(localStorage.getItem('quizUser')).name;
      
      // 1. родро▒рпНрокрпЛродрпИроп рокропройро░ро┐ройрпН ро╡ро░ро▓ро╛ро▒рпНро▒рпИрокрпН рокрпБродрпБрокрпНрокро┐роХрпНроХ
      let myHistory = JSON.parse(localStorage.getItem('quizHistory_' + userName)) || [];
      const newResult = {
        title: title,
        score: score,
        total: total,
        percentage: percentage,
        date: new Date().toLocaleString('ta-IN')
      };
      myHistory.unshift(newResult);
      localStorage.setItem('quizHistory_' + userName, JSON.stringify(myHistory));

      // 2. роЕройрпИродрпНродрпБрокрпН рокропройро░рпНроХро│ро┐ройрпН роорпБропро▒рпНроЪро┐роХро│ро┐ройрпН роОрогрпНрогро┐роХрпНроХрпИропрпИрокрпН рокрпБродрпБрокрпНрокро┐роХрпНроХ
      let allAttempts = JSON.parse(localStorage.getItem('allUserAttempts')) || {};
      allAttempts[userName] = (allAttempts[userName] || 0) + 1;
      localStorage.setItem('allUserAttempts', JSON.stringify(allAttempts));
      
      loadDashboardData(userName);
    }

    /**
     * роЯро╛ро╖рпНрокрпЛро░рпНроЯрпБ рооро▒рпНро▒рпБроорпН рокроЩрпНроХрпЗро▒рпНрокро╛ро│ро░рпНроХро│рпН рокрпБро│рпНро│ро┐ро╡ро┐ро╡ро░роЩрпНроХро│рпИрокрпН рокрпБродрпБрокрпНрокро┐роХрпНроХро┐ро▒родрпБ.
     */
    function loadDashboardData(userName) {
      // 1. роЙроЩрпНроХро│ро┐ройрпН роЪрпКроирпНрод ро╡ро░ро▓ро╛ро▒рпНро▒рпИ роПро▒рпНро▒ро▓рпН
      let myHistory = JSON.parse(localStorage.getItem('quizHistory_' + userName)) || [];
      historyTableBodyEl.innerHTML = ""; 
      
      if (myHistory.length === 0) {
        noHistoryMsgEl.style.display = "block";
        historyTableBodyEl.style.display = "none";
        statTotalAttemptsEl.textContent = "0";
        statAvgScoreEl.textContent = "0%";
      } else {
        noHistoryMsgEl.style.display = "none";
        historyTableBodyEl.style.display = "";
        let totalPercentage = 0;
        myHistory.forEach(result => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${result.date}</td>
            <td>${result.title}</td>
            <td><strong>${result.score} / ${result.total}</strong> (${result.percentage}%)</td>
          `;
          historyTableBodyEl.appendChild(row);
          totalPercentage += result.percentage;
        });
        const avgScore = Math.round(totalPercentage / myHistory.length);
        statTotalAttemptsEl.textContent = myHistory.length;
        statAvgScoreEl.textContent = `${avgScore}%`;
      }
      
      // 2. рокроЩрпНроХрпЗро▒рпНрокро╛ро│ро░рпНроХро│рпН рокроЯрпНроЯро┐ропро▓рпИ роПро▒рпНро▒ро▓рпН (Leaderboard)
      let allAttempts = JSON.parse(localStorage.getItem('allUserAttempts')) || {};
      let leaderboardData = [];
      
      for (const [name, count] of Object.entries(allAttempts)) {
        leaderboardData.push({ name: name, attempts: count });
      }
      
      // роЕродро┐роХ роорпБропро▒рпНроЪро┐роХро│ро┐ройрпН роЕроЯро┐рокрпНрокроЯрпИропро┐ро▓рпН ро╡ро░ро┐роЪрпИрокрпНрокроЯрпБродрпНродрпБродро▓рпН
      leaderboardData.sort((a, b) => b.attempts - a.attempts);

      leaderboardTableBodyEl.innerHTML = "";
      leaderboardData.forEach(user => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${user.name} ${user.name === userName ? ' (роирпАроЩрпНроХ)' : ''}</td>
          <td>${user.attempts}</td>
        `;
        leaderboardTableBodyEl.appendChild(row);
      });
      
      // 3. роорпКродрпНродрокрпН рокроЩрпНроХрпЗро▒рпНрокро╛ро│ро░рпН роОрогрпНрогро┐роХрпНроХрпИропрпИрокрпН рокрпБродрпБрокрпНрокро┐родрпНродро▓рпН
      totalParticipantsEl.textContent = leaderboardData.length;
    }


    document.getElementById('tv-restart-btn').addEventListener('click', () => {
        stopTimer(); 
        stopInactivityTimer(); 
        toggleFixedFooter(false); // ЁЯСС рокрпБродро┐роп рооро╛ро▒рпНро▒роорпН ЁЯСС

        document.getElementById('tv-results').style.display = 'none';
        document.getElementById('tv-progress').style.display = 'none';
        document.getElementById('tv-question').style.display = 'none';
        document.getElementById('tv-options').innerHTML = '';
        document.getElementById('tv-feedback').style.display = 'none';
        
        const timerBox = document.getElementById('tv-timer-box');
        if (timerBox) timerBox.style.display = 'none';

        document.getElementById('quizSelect').selectedIndex = 0;
    });

    loginBtn.addEventListener('click', () => {
      const username = usernameInput.value.trim();
      if (username === "") {
        alert("Please enter your name (роЙроЩрпНроХро│рпН рокрпЖропро░рпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН)");
        return;
      }
      const userData = { name: username };
      localStorage.setItem('quizUser', JSON.stringify(userData));
      
      // роТро╡рпНро╡рпКро░рпБ рокропройро░рпБроХрпНроХрпБроорпН родройро┐ ро╡ро░ро▓ро╛ро▒рпБ, рокрпКродрпБро╡ро╛рой роорпБропро▒рпНроЪро┐роХрпН роХрогроХрпНроХрпБ
      if (!localStorage.getItem('allUserAttempts')) {
        localStorage.setItem('allUserAttempts', JSON.stringify({}));
      }
      
      showApp();
    });

    logoutBtn.addEventListener('click', () => {
      if (confirm("ро╡рпЖро│ро┐ропрпЗро▒ ро╡ро┐ро░рпБроорпНрокрпБроХро┐ро▒рпАро░рпНроХро│ро╛? роЙроЩрпНроХро│ро┐ройрпН роородро┐рокрпНрокрпЖрогрпН ро╡ро░ро▓ро╛ро▒рпБ роороЯрпНроЯрпБроорпН роирпАроХрпНроХрокрпНрокроЯро╛родрпБ, роЖройро╛ро▓рпН роирпАроЩрпНроХро│рпН роорпАрогрпНроЯрпБроорпН роЙро│рпНроирпБро┤рпИроп ро╡рпЗрогрпНроЯрпБроорпН.")) {
        stopTimer(); 
        stopInactivityTimer(); 
        toggleFixedFooter(false); // ЁЯСС рокрпБродро┐роп рооро╛ро▒рпНро▒роорпН ЁЯСС
        localStorage.removeItem('quizUser');
        // роХрпБро▒ро┐рокрпНрокрпБ: 'allUserAttempts' роЕро▓рпНро▓родрпБ роЙроЩрпНроХро│ро┐ройрпН 'quizHistory_<name>' роирпАроХрпНроХрокрпНрокроЯро╡ро┐ро▓рпНро▓рпИ.
        window.location.reload();
      }
    });

    document.addEventListener('DOMContentLoaded', checkLogin);

  </script>
</body>
</html>
